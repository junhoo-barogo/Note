<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1119px" preserveAspectRatio="none" style="width:716px;height:1119px;background:#FFFFFF;" version="1.1" viewBox="0 0 716 1119" width="716px" zoomAndPan="magnify"><defs><filter height="300%" id="f8ro5i3uhu9iz" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="252.1055" style="stroke:#A80036;stroke-width:1.0;" width="10" x="39" y="71.7988"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="165.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="44" y="158.7305"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="39" y="961.002"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="63.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="553.0098"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="703.207"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="863.0703"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="319.3711" style="stroke:#000000;stroke-width:2.0;" width="692" x="10" y="491.0781"/><rect fill="#FFFFFF" height="143.5078" style="stroke:none;stroke-width:1.0;" width="692" x="10" y="666.9414"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="692" x="10" y="824.4492"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="144.2422" style="stroke:#000000;stroke-width:2.0;" width="296" x="10" y="914.3809"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="44" x2="44" y1="40.4883" y2="1075.623"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="426.5" x2="426.5" y1="40.4883" y2="1075.623"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="659" x2="659" y1="40.4883" y2="1075.623"/><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="44" x="20" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="27" y="25.5352">ZOO</text><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="44" x="20" y="1074.623"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="30" x="27" y="1095.1582">ZOO</text><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="69" x="390.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="397.5" y="25.5352">GORELA</text><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="69" x="390.5" y="1074.623"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="397.5" y="1095.1582">GORELA</text><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="626" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="633" y="25.5352">타배대사</text><rect fill="#FEFECE" filter="url(#f8ro5i3uhu9iz)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="626" y="1074.623"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="633" y="1095.1582">타배대사</text><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="252.1055" style="stroke:#A80036;stroke-width:1.0;" width="10" x="39" y="71.7988"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="165.1738" style="stroke:#A80036;stroke-width:1.0;" width="10" x="44" y="158.7305"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="39" y="961.002"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="63.6211" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="553.0098"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="703.207"/><rect fill="#FFFFFF" filter="url(#f8ro5i3uhu9iz)" height="29.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="422" y="863.0703"/><polygon fill="#A80036" points="60,67.7988,50,71.7988,60,75.7988,56,71.7988" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="426" y1="71.7988" y2="71.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="258" x="66" y="67.0566">(open api) 배달요청 (typeCode : 'DELIVERY')</text><line style="stroke:#A80036;stroke-width:1.0;" x1="427" x2="469" y1="116.4199" y2="116.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="469" x2="469" y1="116.4199" y2="129.4199"/><line style="stroke:#A80036;stroke-width:1.0;" x1="428" x2="469" y1="129.4199" y2="129.4199"/><polygon fill="#A80036" points="438,125.4199,428,129.4199,438,133.4199,434,129.4199" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="434" y="96.3672">n초</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="458" y="96.3672">경과시에도 배차가 안되었다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="434" y="111.6777">타배대사에 공유 판단</text><polygon fill="#A80036" points="65,154.7305,55,158.7305,65,162.7305,61,158.7305" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="426" y1="158.7305" y2="158.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="300" x="71" y="153.9883">(open api) 배달 회수 (내가 아까 준 오더 잠깐 빌려갈게요)</text><polygon fill="#A80036" points="415,199.3516,425,203.3516,415,207.3516,419,203.3516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="421" y1="203.3516" y2="203.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="61" y="183.2988">"특정조건"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="121" y="183.2988">이 맞는 오더라면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="240" x="61" y="198.6094">배달대행료는 발주측 수수료 제외한 금액을 전달</text><path d="M59,216.3516 L59,271.3516 L493,271.3516 L493,226.3516 L483,216.3516 L59,216.3516 " fill="#FBFB77" filter="url(#f8ro5i3uhu9iz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M483,216.3516 L483,226.3516 L493,226.3516 L483,216.3516 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="56" x="65" y="233.9199">"특정조건"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="65" y="249.2305">["타배대사 가상 수행허브"에 공유한 상점의 오더인가?]</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="121" x="343" y="249.2305">(테스트 대상 상점 여부)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="413" x="65" y="264.541">이 외 조건들이 존재하지만, "타배대사 가상 수행허브"에 상점 공유설정시 반영예정</text><line style="stroke:#A80036;stroke-width:1.0;" x1="54" x2="96" y1="322.9043" y2="322.9043"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="96" y1="322.9043" y2="335.9043"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="96" y1="335.9043" y2="335.9043"/><polygon fill="#A80036" points="59,331.9043,49,335.9043,59,339.9043,55,335.9043" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="61" y="302.8516">ZOO, O2O 에서는 해당 오더들을</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="34" x="61" y="318.1621">"배차"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="95" y="318.1621">상태 로 표기한다</text><path d="M49,343.9043 L49,444.9043 L396,444.9043 L396,353.9043 L386,343.9043 L49,343.9043 " fill="#FBFB77" filter="url(#f8ro5i3uhu9iz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M386,343.9043 L386,353.9043 L396,353.9043 L386,343.9043 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="191" x="55" y="361.4727">라이더,발주허브의 수정권한 제한 필요</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="55" y="376.7832">(O2O) 즉시배차,강제배차,픽업 등 상태변경 프로시저</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="322" x="55" y="392.0938">가상 수행허브가 배차중인 오더의 경우(하드코딩) 권한 제한한다,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="0" x="59" y="407.4043"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="107" x="55" y="422.7148">발주허브에 안내 필요</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272" x="55" y="438.0254">"타배대사에 공유 중인 배달은 배차상태로 표기됩니다"</text><polygon fill="#A80036" points="647,472.0781,657,476.0781,647,480.0781,651,476.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="427" x2="653" y1="476.0781" y2="476.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="176" x="434" y="471.3359">ZOO 에서 빌려간 오더를 공유한다</text><path d="M10,491.0781 L72,491.0781 L72,498.0781 L62,508.0781 L10,508.0781 L10,491.0781 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="319.3711" style="stroke:#000000;stroke-width:2.0;" width="692" x="10" y="491.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="504.6465">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="87" y="503.7129">[</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="17" x="91" y="503.7129">n초</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="166" x="112" y="503.7129">내에 타배대사에서 배차가 안된경우]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="427" x2="474" y1="540.0098" y2="540.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="474" x2="474" y1="540.0098" y2="553.0098"/><line style="stroke:#A80036;stroke-width:1.0;" x1="433" x2="474" y1="553.0098" y2="553.0098"/><polygon fill="#A80036" points="443,549.0098,433,553.0098,443,557.0098,439,553.0098" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="439" y="519.957">n초</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="463" y="519.957">경과시에도 배차가 안되었다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="439" y="535.2676">배달을 다시 돌려준다</text><polygon fill="#A80036" points="647,583.3203,657,587.3203,647,591.3203,651,587.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="432" x2="653" y1="587.3203" y2="587.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="117" x="439" y="582.5781">"이제 공유 그만할게요"</text><polygon fill="#A80036" points="55,612.6309,45,616.6309,55,620.6309,51,616.6309" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="426" y1="616.6309" y2="616.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="354" x="61" y="611.8887">(open api) "타배대사도 배차 안되네요... 이제 알아서 하세요" 이벤트</text><line style="stroke:#A80036;stroke-width:1.0;" x1="44" x2="86" y1="645.9414" y2="645.9414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="86" x2="86" y1="645.9414" y2="658.9414"/><line style="stroke:#A80036;stroke-width:1.0;" x1="45" x2="86" y1="658.9414" y2="658.9414"/><polygon fill="#A80036" points="55,654.9414,45,658.9414,55,662.9414,51,658.9414" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="51" y="641.1992">일반오더처럼 처리</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="702" y1="667.9414" y2="667.9414"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="15" y="678.5762">[</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="17" x="19" y="678.5762">n초</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="156" x="40" y="678.5762">내에 타배대사에서 배차가 된경우]</text><polygon fill="#A80036" points="443,699.207,433,703.207,443,707.207,439,703.207" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="437" x2="658" y1="703.207" y2="703.207"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="449" y="698.4648">픽업,완료 이벤트</text><polygon fill="#A80036" points="55,728.5176,45,732.5176,55,736.5176,51,732.5176" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="426" y1="732.5176" y2="732.5176"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="151" x="61" y="727.7754">(open api) 픽업,완료 이벤트</text><path d="M49,745.5176 L49,800.5176 L635,800.5176 L635,755.5176 L625,745.5176 L49,745.5176 " fill="#FBFB77" filter="url(#f8ro5i3uhu9iz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M625,745.5176 L625,755.5176 L635,755.5176 L625,745.5176 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333" x="55" y="763.0859">- 타배대사에 공유된 시점에서 이미 배차상태이므로 배차는 안받음</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="337" x="55" y="778.3965">- 수행배대사인 타배대사에는 오더수정 권한, 오더취소 권한은 없다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="167" x="55" y="793.707">- 타배대사에서 배차가 되었는데,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="226" y="793.707">n초</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="370" x="250" y="793.707">체크 시점 이후 배차취소가 되면, 해당 오더는 영영 타배대사로 넘어가게됨</text><path d="M10,824.4492 L72,824.4492 L72,831.4492 L62,841.4492 L10,841.4492 L10,824.4492 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="75.9316" style="stroke:#000000;stroke-width:2.0;" width="692" x="10" y="824.4492"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="838.0176">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="210" x="87" y="837.084">[바로고 발주허브에서 오더수정이 발생한경우]</text><polygon fill="#A80036" points="410,859.0703,420,863.0703,410,867.0703,414,863.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="44" x2="416" y1="863.0703" y2="863.0703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="51" y="858.3281">취소, 각종 배달수정 이벤트</text><polygon fill="#A80036" points="647,888.3809,657,892.3809,647,896.3809,651,892.3809" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="427" x2="653" y1="892.3809" y2="892.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203" x="434" y="887.6387">(open api) 취소, 각종 배달수정 이벤트</text><path d="M10,914.3809 L72,914.3809 L72,921.3809 L62,931.3809 L10,931.3809 L10,914.3809 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="144.2422" style="stroke:#000000;stroke-width:2.0;" width="296" x="10" y="914.3809"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="927.9492">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="214" x="87" y="927.0156">[openApi 로부터 완료 이벤트를 수신할 경우]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="49" x2="91" y1="953.002" y2="953.002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="91" x2="91" y1="953.002" y2="966.002"/><line style="stroke:#A80036;stroke-width:1.0;" x1="50" x2="91" y1="966.002" y2="966.002"/><polygon fill="#A80036" points="60,962.002,50,966.002,60,970.002,56,966.002" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149" x="56" y="948.2598">오라클 정산프로시저 02 실행</text><path d="M49,1009.002 L49,1049.002 L258,1049.002 L258,1019.002 L248,1009.002 L49,1009.002 " fill="#FBFB77" filter="url(#f8ro5i3uhu9iz)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M248,1009.002 L248,1019.002 L258,1019.002 L248,1009.002 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="55" y="1026.5703">타배대사 가상 수행허브인지 확인하여</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177" x="55" y="1041.8809">추가적인 로직이 필요할지 검토필요</text><!--MD5=[78501a217a0c4089f397a9c877d680e1]
@startuml
participant ZOO as ZOO
participant GORELA as GORELA
participant 타배대사 as 타배대사

GORELA -> ZOO ++ : (open api) 배달요청 (typeCode : 'DELIVERY')
GORELA -> GORELA : **n초** 경과시에도 배차가 안되었다면\n타배대사에 공유 판단
GORELA -> ZOO ++ : (open api) 배달 회수 (내가 아까 준 오더 잠깐 빌려갈게요)
ZOO -> GORELA : **"특정조건"** 이 맞는 오더라면\n배달대행료는 발주측 수수료 제외한 금액을 전달
note right of ZOO
    **"특정조건"**
    ["타배대사 가상 수행허브"에 공유한 상점의 오더인가?] **(테스트 대상 상점 여부)**
    이 외 조건들이 존재하지만, "타배대사 가상 수행허브"에 상점 공유설정시 반영예정
end note

ZOO -> ZOO : ZOO, O2O 에서는 해당 오더들을\n**"배차"**상태 로 표기한다
deactivate

note right of ZOO
      **라이더,발주허브의 수정권한 제한 필요**
      (O2O) 즉시배차,강제배차,픽업 등 상태변경 프로시저
      가상 수행허브가 배차중인 오더의 경우(하드코딩) 권한 제한한다, 
      
      **발주허브에 안내 필요**
      "타배대사에 공유 중인 배달은 배차상태로 표기됩니다"
end note
deactivate ZOO

GORELA -> 타배대사 : ZOO 에서 빌려간 오더를 공유한다

alt **n초** 내에 타배대사에서 배차가 안된경우
    GORELA -> GORELA ++ : **n초** 경과시에도 배차가 안되었다면\n배달을 다시 돌려준다
    GORELA -> 타배대사 : "이제 공유 그만할게요"
    GORELA -> ZOO : (open api) "타배대사도 배차 안되네요... 이제 알아서 하세요" 이벤트
    deactivate
    ZOO -> ZOO : 일반오더처럼 처리
else **n초** 내에 타배대사에서 배차가 된경우
    타배대사 -> GORELA ++ : 픽업,완료 이벤트
    GORELA -> ZOO : (open api) 픽업,완료 이벤트
    note right of ZOO
      - 타배대사에 공유된 시점에서 이미 배차상태이므로 배차는 안받음
      - 수행배대사인 타배대사에는 오더수정 권한, 오더취소 권한은 없다
      - 타배대사에서 배차가 되었는데, **n초** 체크 시점 이후 배차취소가 되면, 해당 오더는 영영 타배대사로 넘어가게됨
    end note
    deactivate GORELA
end

alt 바로고 발주허브에서 오더수정이 발생한경우
    ZOO -> GORELA ++ : 취소, 각종 배달수정 이벤트
    GORELA -> 타배대사 : (open api) 취소, 각종 배달수정 이벤트
    deactivate
end

alt openApi 로부터 완료 이벤트를 수신할 경우
    ZOO -> ZOO ++ : 오라클 정산프로시저 02 실행
    note right of ZOO
        타배대사 가상 수행허브인지 확인하여
        추가적인 로직이 필요할지 검토필요
    end note
deactivate
end



@end

PlantUML version 1.2022.0(Wed Jan 12 01:16:42 KST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: KR
--></g></svg>