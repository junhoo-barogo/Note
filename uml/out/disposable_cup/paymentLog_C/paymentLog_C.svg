<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1177px" preserveAspectRatio="none" style="width:1004px;height:1177px;background:#FFFFFF;" version="1.1" viewBox="0 0 1004 1177" width="1004px" zoomAndPan="magnify"><defs><filter height="300%" id="f3vlq34lyx0ra" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="328" x="336.25" y="29.4023">일회용컵 비과세 &gt; 결제내역 &gt; Create 요소</text><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="171.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="48" y="400.127"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="57.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="305.5059"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="209.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="614.9219"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="53.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="445" y="644.2324"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="334.8164"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="83.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="726.8535"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="940.0273"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="43.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="998.6484"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="821.5" y="1027.959"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="713.0977" style="stroke:#000000;stroke-width:2.0;" width="725" x="3" y="119.6875"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="373.9922" style="stroke:#000000;stroke-width:2.0;" width="533.5" x="10" y="212.6191"/><rect fill="#FFFFFF" height="317.3711" style="stroke:none;stroke-width:1.0;" width="533.5" x="10" y="269.2402"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="245.4844" style="stroke:#000000;stroke-width:2.0;" width="517" x="473.5" y="846.7852"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="53" x2="53" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="377" x2="377" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="449.5" x2="449.5" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="508.5" x2="508.5" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="602.5" x2="602.5" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="723.5" x2="723.5" y1="102.6875" y2="1109.2695"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="826.5" x2="826.5" y1="102.6875" y2="1109.2695"/><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="20" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="27" y="87.7344">라이더앱</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="20" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="27" y="1128.8047">라이더앱</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="342" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="349" y="87.7344">O2oApi</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="342" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="349" y="1128.8047">O2oApi</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="43" x="426.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="433.5" y="87.7344">VAN</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="43" x="426.5" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="433.5" y="1128.8047">VAN</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="483.5" y="99.7344">Oracle</text><path d="M490.5,50.1992 C490.5,40.1992 508.5,40.1992 508.5,40.1992 C508.5,40.1992 526.5,40.1992 526.5,50.1992 L526.5,76.1992 C526.5,86.1992 508.5,86.1992 508.5,86.1992 C508.5,86.1992 490.5,86.1992 490.5,76.1992 L490.5,50.1992 " fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" style="stroke:#000000;stroke-width:1.5;"/><path d="M490.5,50.1992 C490.5,60.1992 508.5,60.1992 508.5,60.1992 C508.5,60.1992 526.5,60.1992 526.5,50.1992 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="483.5" y="1121.8047">Oracle</text><path d="M490.5,1134.7578 C490.5,1124.7578 508.5,1124.7578 508.5,1124.7578 C508.5,1124.7578 526.5,1124.7578 526.5,1134.7578 L526.5,1160.7578 C526.5,1170.7578 508.5,1170.7578 508.5,1170.7578 C508.5,1170.7578 490.5,1170.7578 490.5,1160.7578 L490.5,1134.7578 " fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" style="stroke:#000000;stroke-width:1.5;"/><path d="M490.5,1134.7578 C490.5,1144.7578 508.5,1144.7578 508.5,1144.7578 C508.5,1144.7578 526.5,1144.7578 526.5,1134.7578 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="556.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="563.5" y="87.7344">ZOO_event</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="556.5" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="563.5" y="1128.8047">ZOO_event</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="658.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="665.5" y="87.7344">ZOO_integration</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="658.5" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="665.5" y="1128.8047">ZOO_integration</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="50" x="799.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="806.5" y="87.7344">고릴라</text><rect fill="#FEFECE" filter="url(#f3vlq34lyx0ra)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="50" x="799.5" y="1108.2695"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="806.5" y="1128.8047">고릴라</text><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="171.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="48" y="400.127"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="57.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="305.5059"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="209.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="614.9219"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="53.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="445" y="644.2324"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="334.8164"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="83.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="726.8535"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="940.0273"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="43.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="998.6484"/><rect fill="#FFFFFF" filter="url(#f3vlq34lyx0ra)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="821.5" y="1027.959"/><path d="M3,119.6875 L92,119.6875 L92,126.6875 L82,136.6875 L3,136.6875 L3,119.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="713.0977" style="stroke:#000000;stroke-width:2.0;" width="725" x="3" y="119.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="18" y="133.2559">이번범위</text><path d="M58,141.998 L58,166.998 L481,166.998 L481,151.998 L471,141.998 L58,141.998 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M471,141.998 L471,151.998 L481,151.998 L471,141.998 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="64" y="159.5664">라이더앱과 상점앱의 동작이 일치하여 라이더앱 기준으로 문서를 작성하였습니다</text><polygon fill="#A80036" points="41,193.6191,51,197.6191,41,201.6191,45,197.6191" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="0" x2="47" y1="197.6191" y2="197.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="7" y="192.877">결제</text><path d="M10,212.6191 L72,212.6191 L72,219.6191 L62,229.6191 L10,229.6191 L10,212.6191 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="373.9922" style="stroke:#000000;stroke-width:2.0;" width="533.5" x="10" y="212.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="226.1875">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="279" x="87" y="225.2539">[결제한 이력이 없다면 (카드번호, 현금영수증번호가 없을때)]</text><path d="M58,234.9297 L58,259.9297 L423,259.9297 L423,244.9297 L413,234.9297 L58,234.9297 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M413,234.9297 L413,244.9297 L423,244.9297 L413,234.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="64" y="252.498">[ 결제할 금액 &gt; 비과세금액 ] 일때 비과세 금액을 포함하여 결제한다</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="543.5" y1="270.2402" y2="270.2402"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="342" x="15" y="280.875">[결제한 이력이 있다면 (아래 판단은 사실 서버에서 하는것이 나을수 있음)]</text><polygon fill="#A80036" points="360,301.5059,370,305.5059,360,309.5059,364,305.5059" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="366" y1="305.5059" y2="305.5059"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="60" y="300.7637">결제내역 조회 (결제취소된 이력은 제외하고 확인)</text><polygon fill="#A80036" points="491.5,330.8164,501.5,334.8164,491.5,338.8164,495.5,334.8164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="497.5" y1="334.8164" y2="334.8164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="389" y="330.0742">결제내역 조회</text><polygon fill="#A80036" points="393,344.8164,383,348.8164,393,352.8164,389,348.8164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="507.5" y1="348.8164" y2="348.8164"/><polygon fill="#A80036" points="64,358.8164,54,362.8164,64,366.8164,60,362.8164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="376" y1="362.8164" y2="362.8164"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="100" y1="387.127" y2="387.127"/><line style="stroke:#A80036;stroke-width:1.0;" x1="100" x2="100" y1="387.127" y2="400.127"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="100" y1="400.127" y2="400.127"/><polygon fill="#A80036" points="69,396.127,59,400.127,69,404.127,65,400.127" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="65" y="382.3848">결제내역 정보를 기반으로 비과세 결제를 시킬것인지 판단한다</text><path d="M63,418.127 L63,550.127 L401,550.127 L401,428.127 L391,418.127 L63,418.127 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M391,418.127 L391,428.127 L401,428.127 L391,418.127 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="214" x="69" y="435.6953">PG 테이블에 비과세금액 필드 추가 한다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="69" y="451.0059">로직1. [ 결제할 금액 &gt; 비과세금액 ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="69" y="466.3164">로직2. [ 비과세금액이 결제내역에 없었는가? ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="69" y="481.627">위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="69" y="496.9375">PG 테이블에 비과세금액 필드 추가 하지 않는다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="69" y="512.248">로직1. [ 결제할 금액 &gt; 비과세금액 ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="298" x="69" y="527.5586">로직2. [ 결제금액 &gt; 비과세금액 인 결제내역에 없었는가? ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="69" y="542.8691">위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="100" y1="570.6113" y2="570.6113"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="100" y1="570.6113" y2="583.6113"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="100" y1="583.6113" y2="583.6113"/><polygon fill="#A80036" points="63,579.6113,53,583.6113,63,587.6113,59,583.6113" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="360,610.9219,370,614.9219,360,618.9219,364,614.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="366" y1="614.9219" y2="614.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="60" y="610.1797">결제요청</text><polygon fill="#A80036" points="433,640.2324,443,644.2324,433,648.2324,437,644.2324" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="439" y1="644.2324" y2="644.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="389" y="639.4902">결제요청</text><path d="M316,657.2324 L316,682.2324 L579,682.2324 L579,667.2324 L569,657.2324 L316,657.2324 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M569,657.2324 L569,667.2324 L579,667.2324 L569,657.2324 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="70" x="322" y="674.8008">PAY_LATER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="396" y="674.8008">값을 VAN 사 규격에 맞춰 보낸다</text><polygon fill="#A80036" points="393,693.543,383,697.543,393,701.543,389,697.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="449" y1="697.543" y2="697.543"/><polygon fill="#A80036" points="491.5,722.8535,501.5,726.8535,491.5,730.8535,495.5,726.8535" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="497.5" y1="726.8535" y2="726.8535"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="389" y="722.1113">결제내역 INSERT</text><path d="M299,739.8535 L299,794.8535 L714,794.8535 L714,749.8535 L704,739.8535 L299,739.8535 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M704,739.8535 L704,749.8535 L714,749.8535 L704,739.8535 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="305" y="757.4219">1안)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="70" x="332" y="757.4219">PAY_LATER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="406" y="757.4219">필드를 얼터하여 넣는다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="305" y="772.7324">2안) ORD_NO 로 JOIN 가능하므로 넣지않는다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="394" x="305" y="788.043">(리마인드 : 현금인경우 VAN 에 요청하지 않더라도 현금영수증 기록을 남긴다)</text><polygon fill="#A80036" points="393,806.7852,383,810.7852,393,814.7852,389,810.7852" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="507.5" y1="810.7852" y2="810.7852"/><polygon fill="#A80036" points="64,820.7852,54,824.7852,64,828.7852,60,824.7852" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="376" y1="824.7852" y2="824.7852"/><path d="M473.5,846.7852 L562.5,846.7852 L562.5,853.7852 L552.5,863.7852 L473.5,863.7852 L473.5,846.7852 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="245.4844" style="stroke:#000000;stroke-width:2.0;" width="517" x="473.5" y="846.7852"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="488.5" y="860.3535">다음범위</text><path d="M607,869.0957 L607,909.0957 L976,909.0957 L976,879.0957 L966,869.0957 L607,869.0957 " fill="#FBFB77" filter="url(#f3vlq34lyx0ra)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M966,869.0957 L966,879.0957 L976,879.0957 L966,869.0957 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="613" y="886.6641">아래 내용에 비과세 금액 필드를 추가한다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="613" y="901.9746">(그런데 배민에서 이미 확인가능할텐데, 정말 필요한지 다시 검토필요)</text><polygon fill="#A80036" points="524.5,936.0273,514.5,940.0273,524.5,944.0273,520.5,940.0273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="518.5" x2="601.5" y1="940.0273" y2="940.0273"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="530.5" y="935.2852">결제내역 조회</text><polygon fill="#A80036" points="590.5,950.0273,600.5,954.0273,590.5,958.0273,594.5,954.0273" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508.5" x2="596.5" y1="954.0273" y2="954.0273"/><polygon fill="#A80036" points="707,994.6484,717,998.6484,707,1002.6484,711,998.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602.5" x2="713" y1="998.6484" y2="998.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="609.5" y="978.5957">이벤트 전송</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="609.5" y="993.9063">(via.kafka)</text><polygon fill="#A80036" points="809.5,1023.959,819.5,1027.959,809.5,1031.959,813.5,1027.959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="729" x2="815.5" y1="1027.959" y2="1027.959"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="736" y="1023.2168">이벤트전송</text><polygon fill="#A80036" points="735,1037.959,725,1041.959,735,1045.959,731,1041.959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="729" x2="825.5" y1="1041.959" y2="1041.959"/><line style="stroke:#A80036;stroke-width:1.0;" x1="826.5" x2="868.5" y1="1071.2695" y2="1071.2695"/><line style="stroke:#A80036;stroke-width:1.0;" x1="868.5" x2="868.5" y1="1071.2695" y2="1084.2695"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="868.5" y1="1084.2695" y2="1084.2695"/><polygon fill="#A80036" points="837.5,1080.2695,827.5,1084.2695,837.5,1088.2695,833.5,1084.2695" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="833.5" y="1066.5273">사장님, 주문제휴사에 전송...</text><!--MD5=[d8c508166981274b2ddd65778c251209]
@startuml
participant 라이더앱
participant O2oApi
participant VAN
database Oracle
participant ZOO_event
participant ZOO_integration
participant 고릴라

title 일회용컵 비과세 > 결제내역 > Create 요소

group 이번범위
    note right of 라이더앱 
        라이더앱과 상점앱의 동작이 일치하여 라이더앱 기준으로 문서를 작성하였습니다
    end note
    -> 라이더앱 : 결제
    alt 결제한 이력이 없다면 (카드번호, 현금영수증번호가 없을때)
        note right of 라이더앱
            [ 결제할 금액 > 비과세금액 ] 일때 비과세 금액을 포함하여 결제한다
        end note
    else 결제한 이력이 있다면 (아래 판단은 사실 서버에서 하는것이 나을수 있음)
        라이더앱 -> O2oApi ++ : 결제내역 조회 (결제취소된 이력은 제외하고 확인)
        O2oApi -> Oracle ++ : 결제내역 조회
        return
        return
        라이더앱 -> 라이더앱 ++ : 결제내역 정보를 기반으로 비과세 결제를 시킬것인지 판단한다
        note right of 라이더앱
            **PG 테이블에 비과세금액 필드 추가 한다면**
            로직1. [ 결제할 금액 > 비과세금액 ]
            로직2. [ 비과세금액이 결제내역에 없었는가? ]
            위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다
            **PG 테이블에 비과세금액 필드 추가 하지 않는다면**
            로직1. [ 결제할 금액 > 비과세금액 ]
            로직2. [ 결제금액 > 비과세금액 인 결제내역에 없었는가? ]
            위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다
        end note
        return
    end
    라이더앱 -> O2oApi ++ : 결제요청
    O2oApi -> VAN ++ : 결제요청
    note over VAN
        __PAY_LATER__ 값을 VAN 사 규격에 맞춰 보낸다
    end note
    return
    O2oApi -> Oracle ++ : 결제내역 INSERT
    note over Oracle
        1안) __PAY_LATER__ 필드를 얼터하여 넣는다
        2안) ORD_NO 로 JOIN 가능하므로 넣지않는다
        (리마인드 : 현금인경우 VAN 에 요청하지 않더라도 현금영수증 기록을 남긴다)
    end note
    return 
    return
end

group 다음범위
    note right of ZOO_event
        아래 내용에 비과세 금액 필드를 추가한다
        (그런데 배민에서 이미 확인가능할텐데, 정말 필요한지 다시 검토필요)
    end note
    ZOO_event -> Oracle ++ : 결제내역 조회
    return
    ZOO_event -> ZOO_integration ++ : 이벤트 전송\n(via.kafka)
    ZOO_integration -> 고릴라 ++ : 이벤트전송
    return
    deactivate
    고릴라 -> 고릴라 : 사장님, 주문제휴사에 전송...
end

@enduml

PlantUML version 1.2022.0(Wed Jan 12 01:16:42 KST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: KR
--></g></svg>