<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1217px" preserveAspectRatio="none" style="width:1004px;height:1217px;background:#FFFFFF;" version="1.1" viewBox="0 0 1004 1217" width="1004px" zoomAndPan="magnify"><defs><filter height="300%" id="fjj334zmq202a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="328" x="336.25" y="29.4023">일회용컵 비과세 &gt; 결제내역 &gt; Create 요소</text><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="171.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="48" y="439.4375"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="57.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="344.8164"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="209.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="654.2324"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="53.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="445" y="683.543"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="374.127"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="83.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="766.1641"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="979.3379"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="43.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="1037.959"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="821.5" y="1067.2695"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="752.4082" style="stroke:#000000;stroke-width:2.0;" width="725" x="3" y="119.6875"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="413.3027" style="stroke:#000000;stroke-width:2.0;" width="533.5" x="10" y="212.6191"/><rect fill="#FFFFFF" height="356.6816" style="stroke:none;stroke-width:1.0;" width="533.5" x="10" y="269.2402"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="245.4844" style="stroke:#000000;stroke-width:2.0;" width="517" x="473.5" y="886.0957"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="53" x2="53" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="377" x2="377" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="449.5" x2="449.5" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="508.5" x2="508.5" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="602.5" x2="602.5" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="723.5" x2="723.5" y1="102.6875" y2="1148.5801"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="826.5" x2="826.5" y1="102.6875" y2="1148.5801"/><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="20" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="27" y="87.7344">라이더앱</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="62" x="20" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="27" y="1168.1152">라이더앱</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="342" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="349" y="87.7344">O2oApi</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="66" x="342" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="52" x="349" y="1168.1152">O2oApi</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="43" x="426.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="433.5" y="87.7344">VAN</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="43" x="426.5" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="29" x="433.5" y="1168.1152">VAN</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="483.5" y="99.7344">Oracle</text><path d="M490.5,50.1992 C490.5,40.1992 508.5,40.1992 508.5,40.1992 C508.5,40.1992 526.5,40.1992 526.5,50.1992 L526.5,76.1992 C526.5,86.1992 508.5,86.1992 508.5,86.1992 C508.5,86.1992 490.5,86.1992 490.5,76.1992 L490.5,50.1992 " fill="#FEFECE" filter="url(#fjj334zmq202a)" style="stroke:#000000;stroke-width:1.5;"/><path d="M490.5,50.1992 C490.5,60.1992 508.5,60.1992 508.5,60.1992 C508.5,60.1992 526.5,60.1992 526.5,50.1992 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44" x="483.5" y="1161.1152">Oracle</text><path d="M490.5,1174.0684 C490.5,1164.0684 508.5,1164.0684 508.5,1164.0684 C508.5,1164.0684 526.5,1164.0684 526.5,1174.0684 L526.5,1200.0684 C526.5,1210.0684 508.5,1210.0684 508.5,1210.0684 C508.5,1210.0684 490.5,1210.0684 490.5,1200.0684 L490.5,1174.0684 " fill="#FEFECE" filter="url(#fjj334zmq202a)" style="stroke:#000000;stroke-width:1.5;"/><path d="M490.5,1174.0684 C490.5,1184.0684 508.5,1184.0684 508.5,1184.0684 C508.5,1184.0684 526.5,1184.0684 526.5,1174.0684 " fill="none" style="stroke:#000000;stroke-width:1.5;"/><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="556.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="563.5" y="87.7344">ZOO_event</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="88" x="556.5" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="74" x="563.5" y="1168.1152">ZOO_event</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="658.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="665.5" y="87.7344">ZOO_integration</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="127" x="658.5" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="113" x="665.5" y="1168.1152">ZOO_integration</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="50" x="799.5" y="67.1992"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="806.5" y="87.7344">고릴라</text><rect fill="#FEFECE" filter="url(#fjj334zmq202a)" height="30.4883" style="stroke:#A80036;stroke-width:1.5;" width="50" x="799.5" y="1147.5801"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36" x="806.5" y="1168.1152">고릴라</text><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="171.4844" style="stroke:#A80036;stroke-width:1.0;" width="10" x="48" y="439.4375"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="57.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="344.8164"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="209.8633" style="stroke:#A80036;stroke-width:1.0;" width="10" x="372" y="654.2324"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="53.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="445" y="683.543"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="374.127"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="83.9316" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="766.1641"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="503.5" y="979.3379"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="43.3105" style="stroke:#A80036;stroke-width:1.0;" width="10" x="719" y="1037.959"/><rect fill="#FFFFFF" filter="url(#fjj334zmq202a)" height="14" style="stroke:#A80036;stroke-width:1.0;" width="10" x="821.5" y="1067.2695"/><path d="M3,119.6875 L92,119.6875 L92,126.6875 L82,136.6875 L3,136.6875 L3,119.6875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="752.4082" style="stroke:#000000;stroke-width:2.0;" width="725" x="3" y="119.6875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="18" y="133.2559">이번범위</text><path d="M58,141.998 L58,166.998 L481,166.998 L481,151.998 L471,141.998 L58,141.998 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M471,141.998 L471,151.998 L481,151.998 L471,141.998 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="402" x="64" y="159.5664">라이더앱과 상점앱의 동작이 일치하여 라이더앱 기준으로 문서를 작성하였습니다</text><polygon fill="#A80036" points="41,193.6191,51,197.6191,41,201.6191,45,197.6191" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="0" x2="47" y1="197.6191" y2="197.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="22" x="7" y="192.877">결제</text><path d="M10,212.6191 L72,212.6191 L72,219.6191 L62,229.6191 L10,229.6191 L10,212.6191 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="413.3027" style="stroke:#000000;stroke-width:2.0;" width="533.5" x="10" y="212.6191"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="17" x="25" y="226.1875">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="279" x="87" y="225.2539">[결제한 이력이 없다면 (카드번호, 현금영수증번호가 없을때)]</text><path d="M58,234.9297 L58,259.9297 L423,259.9297 L423,244.9297 L413,234.9297 L58,234.9297 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M413,234.9297 L413,244.9297 L423,244.9297 L413,234.9297 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="344" x="64" y="252.498">[ 결제할 금액 &gt; 비과세금액 ] 일때 비과세 금액을 포함하여 결제한다</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="10" x2="543.5" y1="270.2402" y2="270.2402"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="106" x="15" y="280.875">[결제한 이력이 있다면]</text><path d="M58,289.1953 L58,314.1953 L408,314.1953 L408,299.1953 L398,289.1953 L58,289.1953 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M398,289.1953 L398,299.1953 L408,299.1953 L398,289.1953 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="329" x="64" y="306.7637">아래 결제내역 조회는 사실 서버에서 하는것이 나을 수도 있습니다</text><polygon fill="#A80036" points="360,340.8164,370,344.8164,360,348.8164,364,344.8164" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="366" y1="344.8164" y2="344.8164"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248" x="60" y="340.0742">결제내역 조회 (결제취소된 이력은 제외하고 확인)</text><polygon fill="#A80036" points="491.5,370.127,501.5,374.127,491.5,378.127,495.5,374.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="497.5" y1="374.127" y2="374.127"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="389" y="369.3848">결제내역 조회</text><polygon fill="#A80036" points="393,384.127,383,388.127,393,392.127,389,388.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="507.5" y1="388.127" y2="388.127"/><polygon fill="#A80036" points="64,398.127,54,402.127,64,406.127,60,402.127" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="376" y1="402.127" y2="402.127"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="100" y1="426.4375" y2="426.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="100" x2="100" y1="426.4375" y2="439.4375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="59" x2="100" y1="439.4375" y2="439.4375"/><polygon fill="#A80036" points="69,435.4375,59,439.4375,69,443.4375,65,439.4375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="310" x="65" y="421.6953">결제내역 정보를 기반으로 비과세 결제를 시킬것인지 판단한다</text><path d="M63,457.4375 L63,589.4375 L401,589.4375 L401,467.4375 L391,457.4375 L63,457.4375 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M391,457.4375 L391,467.4375 L401,467.4375 L391,457.4375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="214" x="69" y="475.0059">PG 테이블에 비과세금액 필드 추가 한다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="69" y="490.3164">로직1. [ 결제할 금액 &gt; 비과세금액 ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="232" x="69" y="505.627">로직2. [ 비과세금액이 결제내역에 없었는가? ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="69" y="520.9375">위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="251" x="69" y="536.248">PG 테이블에 비과세금액 필드 추가 하지 않는다면</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="186" x="69" y="551.5586">로직1. [ 결제할 금액 &gt; 비과세금액 ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="294" x="69" y="566.8691">로직2. [ 결제금액 &gt; 비과세금액인 결제내역이 없었는가? ]</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="69" y="582.1797">위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다</text><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="100" y1="609.9219" y2="609.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="100" y1="609.9219" y2="622.9219"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="100" y1="622.9219" y2="622.9219"/><polygon fill="#A80036" points="63,618.9219,53,622.9219,63,626.9219,59,622.9219" style="stroke:#A80036;stroke-width:1.0;"/><polygon fill="#A80036" points="360,650.2324,370,654.2324,360,658.2324,364,654.2324" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="53" x2="366" y1="654.2324" y2="654.2324"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="60" y="649.4902">결제요청</text><polygon fill="#A80036" points="433,679.543,443,683.543,433,687.543,437,683.543" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="439" y1="683.543" y2="683.543"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="44" x="389" y="678.8008">결제요청</text><path d="M316,696.543 L316,721.543 L579,721.543 L579,706.543 L569,696.543 L316,696.543 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M569,696.543 L569,706.543 L579,706.543 L569,696.543 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="70" x="322" y="714.1113">PAY_LATER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="396" y="714.1113">값을 VAN 사 규격에 맞춰 보낸다</text><polygon fill="#A80036" points="393,732.8535,383,736.8535,393,740.8535,389,736.8535" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="449" y1="736.8535" y2="736.8535"/><polygon fill="#A80036" points="491.5,762.1641,501.5,766.1641,491.5,770.1641,495.5,766.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="382" x2="497.5" y1="766.1641" y2="766.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="389" y="761.4219">결제내역 INSERT</text><path d="M299,779.1641 L299,834.1641 L714,834.1641 L714,789.1641 L704,779.1641 L299,779.1641 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M704,779.1641 L704,789.1641 L714,789.1641 L704,779.1641 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="23" x="305" y="796.7324">1안)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" text-decoration="underline" textLength="70" x="332" y="796.7324">PAY_LATER</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="406" y="796.7324">필드를 얼터하여 넣는다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="247" x="305" y="812.043">2안) ORD_NO 로 JOIN 가능하므로 넣지않는다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="394" x="305" y="827.3535">(리마인드 : 현금인경우 VAN 에 요청하지 않더라도 현금영수증 기록을 남긴다)</text><polygon fill="#A80036" points="393,846.0957,383,850.0957,393,854.0957,389,850.0957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="387" x2="507.5" y1="850.0957" y2="850.0957"/><polygon fill="#A80036" points="64,860.0957,54,864.0957,64,868.0957,60,864.0957" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="58" x2="376" y1="864.0957" y2="864.0957"/><path d="M473.5,886.0957 L562.5,886.0957 L562.5,893.0957 L552.5,903.0957 L473.5,903.0957 L473.5,886.0957 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="245.4844" style="stroke:#000000;stroke-width:2.0;" width="517" x="473.5" y="886.0957"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="44" x="488.5" y="899.6641">다음범위</text><path d="M607,908.4063 L607,948.4063 L976,948.4063 L976,918.4063 L966,908.4063 L607,908.4063 " fill="#FBFB77" filter="url(#fjj334zmq202a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M966,908.4063 L966,918.4063 L976,918.4063 L966,908.4063 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="613" y="925.9746">아래 내용에 비과세 금액 필드를 추가한다</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="348" x="613" y="941.2852">(그런데 배민에서 이미 확인가능할텐데, 정말 필요한지 다시 검토필요)</text><polygon fill="#A80036" points="524.5,975.3379,514.5,979.3379,524.5,983.3379,520.5,979.3379" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="518.5" x2="601.5" y1="979.3379" y2="979.3379"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="70" x="530.5" y="974.5957">결제내역 조회</text><polygon fill="#A80036" points="590.5,989.3379,600.5,993.3379,590.5,997.3379,594.5,993.3379" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="508.5" x2="596.5" y1="993.3379" y2="993.3379"/><polygon fill="#A80036" points="707,1033.959,717,1037.959,707,1041.959,711,1037.959" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="602.5" x2="713" y1="1037.959" y2="1037.959"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="59" x="609.5" y="1017.9063">이벤트 전송</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="609.5" y="1033.2168">(via.kafka)</text><polygon fill="#A80036" points="809.5,1063.2695,819.5,1067.2695,809.5,1071.2695,813.5,1067.2695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="729" x2="815.5" y1="1067.2695" y2="1067.2695"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="55" x="736" y="1062.5273">이벤트전송</text><polygon fill="#A80036" points="735,1077.2695,725,1081.2695,735,1085.2695,731,1081.2695" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="729" x2="825.5" y1="1081.2695" y2="1081.2695"/><line style="stroke:#A80036;stroke-width:1.0;" x1="826.5" x2="868.5" y1="1110.5801" y2="1110.5801"/><line style="stroke:#A80036;stroke-width:1.0;" x1="868.5" x2="868.5" y1="1110.5801" y2="1123.5801"/><line style="stroke:#A80036;stroke-width:1.0;" x1="827.5" x2="868.5" y1="1123.5801" y2="1123.5801"/><polygon fill="#A80036" points="837.5,1119.5801,827.5,1123.5801,837.5,1127.5801,833.5,1123.5801" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="833.5" y="1105.8379">사장님, 주문제휴사에 전송...</text><!--MD5=[94ebd991df0a55c0b70c48b591970aef]
@startuml
participant 라이더앱
participant O2oApi
participant VAN
database Oracle
participant ZOO_event
participant ZOO_integration
participant 고릴라

title 일회용컵 비과세 > 결제내역 > Create 요소

group 이번범위
    note right of 라이더앱 
        라이더앱과 상점앱의 동작이 일치하여 라이더앱 기준으로 문서를 작성하였습니다
    end note
    -> 라이더앱 : 결제
    alt 결제한 이력이 없다면 (카드번호, 현금영수증번호가 없을때)
        note right of 라이더앱
            [ 결제할 금액 > 비과세금액 ] 일때 비과세 금액을 포함하여 결제한다
        end note
    else 결제한 이력이 있다면
        note right of 라이더앱 : 아래 결제내역 조회는 사실 서버에서 하는것이 나을 수도 있습니다
        라이더앱 -> O2oApi ++ : 결제내역 조회 (결제취소된 이력은 제외하고 확인)
        O2oApi -> Oracle ++ : 결제내역 조회
        return
        return
        라이더앱 -> 라이더앱 ++ : 결제내역 정보를 기반으로 비과세 결제를 시킬것인지 판단한다
        note right of 라이더앱
            **PG 테이블에 비과세금액 필드 추가 한다면**
            로직1. [ 결제할 금액 > 비과세금액 ]
            로직2. [ 비과세금액이 결제내역에 없었는가? ]
            위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다
            **PG 테이블에 비과세금액 필드 추가 하지 않는다면**
            로직1. [ 결제할 금액 > 비과세금액 ]
            로직2. [ 결제금액 > 비과세금액인 결제내역이 없었는가? ]
            위 두 로직이 모두 TRUE 이면 비과세금액을 포함하여 결제한다
        end note
        return
    end
    라이더앱 -> O2oApi ++ : 결제요청
    O2oApi -> VAN ++ : 결제요청
    note over VAN
        __PAY_LATER__ 값을 VAN 사 규격에 맞춰 보낸다
    end note
    return
    O2oApi -> Oracle ++ : 결제내역 INSERT
    note over Oracle
        1안) __PAY_LATER__ 필드를 얼터하여 넣는다
        2안) ORD_NO 로 JOIN 가능하므로 넣지않는다
        (리마인드 : 현금인경우 VAN 에 요청하지 않더라도 현금영수증 기록을 남긴다)
    end note
    return 
    return
end

group 다음범위
    note right of ZOO_event
        아래 내용에 비과세 금액 필드를 추가한다
        (그런데 배민에서 이미 확인가능할텐데, 정말 필요한지 다시 검토필요)
    end note
    ZOO_event -> Oracle ++ : 결제내역 조회
    return
    ZOO_event -> ZOO_integration ++ : 이벤트 전송\n(via.kafka)
    ZOO_integration -> 고릴라 ++ : 이벤트전송
    return
    deactivate
    고릴라 -> 고릴라 : 사장님, 주문제휴사에 전송...
end

@enduml

PlantUML version 1.2022.0(Wed Jan 12 01:16:42 KST 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: KR
--></g></svg>